{"ast":null,"code":"const Fetcher = require('./fetcher.js');\nconst fsm = require('fs-minipass');\nconst cacache = require('cacache');\nconst {\n  promisify\n} = require('util');\nconst readPackageJson = require('read-package-json-fast');\nconst _tarballFromResolved = Symbol.for('pacote.Fetcher._tarballFromResolved');\nconst _exeBins = Symbol('_exeBins');\nconst {\n  resolve\n} = require('path');\nconst fs = require('fs');\nclass FileFetcher extends Fetcher {\n  constructor(spec, opts) {\n    super(spec, opts);\n    // just the fully resolved filename\n    this.resolved = this.spec.fetchSpec;\n  }\n  get types() {\n    return ['file'];\n  }\n  manifest() {\n    if (this.package) return Promise.resolve(this.package);\n\n    // have to unpack the tarball for this.\n    return cacache.tmp.withTmp(this.cache, this.opts, dir => this.extract(dir).then(() => readPackageJson(dir + '/package.json')).then(mani => this.package = {\n      ...mani,\n      _integrity: this.integrity && String(this.integrity),\n      _resolved: this.resolved,\n      _from: this.from\n    }));\n  }\n  [_exeBins](pkg, dest) {\n    if (!pkg.bin) return Promise.resolve();\n    return Promise.all(Object.keys(pkg.bin).map(k => new Promise(res => {\n      const script = resolve(dest, pkg.bin[k]);\n      // Best effort.  Ignore errors here, the only result is that\n      // a bin script is not executable.  But if it's missing or\n      // something, we just leave it for a later stage to trip over\n      // when we can provide a more useful contextual error.\n      fs.stat(script, (er, st) => {\n        if (er) return res();\n        const mode = st.mode | 0o111;\n        if (mode === st.mode) return res();\n        fs.chmod(script, mode, res);\n      });\n    })));\n  }\n  extract(dest) {\n    // if we've already loaded the manifest, then the super got it.\n    // but if not, read the unpacked manifest and chmod properly.\n    return super.extract(dest).then(result => this.package ? result : readPackageJson(dest + '/package.json').then(pkg => this[_exeBins](pkg, dest)).then(() => result));\n  }\n  [_tarballFromResolved]() {\n    // create a read stream and return it\n    return new fsm.ReadStream(this.resolved);\n  }\n  packument() {\n    // simulate based on manifest\n    return this.manifest().then(mani => ({\n      name: mani.name,\n      'dist-tags': {\n        [this.defaultTag]: mani.version\n      },\n      versions: {\n        [mani.version]: {\n          ...mani,\n          dist: {\n            tarball: `file:${this.resolved}`,\n            integrity: this.integrity && String(this.integrity)\n          }\n        }\n      }\n    }));\n  }\n}\nmodule.exports = FileFetcher;","map":{"version":3,"names":["Fetcher","require","fsm","cacache","promisify","readPackageJson","_tarballFromResolved","Symbol","for","_exeBins","resolve","fs","FileFetcher","constructor","spec","opts","resolved","fetchSpec","types","manifest","package","Promise","tmp","withTmp","cache","dir","extract","then","mani","_integrity","integrity","String","_resolved","_from","from","pkg","dest","bin","all","Object","keys","map","k","res","script","stat","er","st","mode","chmod","result","ReadStream","packument","name","defaultTag","version","versions","dist","tarball","module","exports"],"sources":["C:/Users/Felo/node_modules/npm/node_modules/pacote/lib/file.js"],"sourcesContent":["const Fetcher = require('./fetcher.js')\nconst fsm = require('fs-minipass')\nconst cacache = require('cacache')\nconst { promisify } = require('util')\nconst readPackageJson = require('read-package-json-fast')\nconst _tarballFromResolved = Symbol.for('pacote.Fetcher._tarballFromResolved')\nconst _exeBins = Symbol('_exeBins')\nconst { resolve } = require('path')\nconst fs = require('fs')\n\nclass FileFetcher extends Fetcher {\n  constructor (spec, opts) {\n    super(spec, opts)\n    // just the fully resolved filename\n    this.resolved = this.spec.fetchSpec\n  }\n\n  get types () {\n    return ['file']\n  }\n\n  manifest () {\n    if (this.package)\n      return Promise.resolve(this.package)\n\n    // have to unpack the tarball for this.\n    return cacache.tmp.withTmp(this.cache, this.opts, dir =>\n      this.extract(dir)\n      .then(() => readPackageJson(dir + '/package.json'))\n      .then(mani => this.package = {\n        ...mani,\n        _integrity: this.integrity && String(this.integrity),\n        _resolved: this.resolved,\n        _from: this.from,\n      }))\n  }\n\n  [_exeBins] (pkg, dest) {\n    if (!pkg.bin)\n      return Promise.resolve()\n\n    return Promise.all(Object.keys(pkg.bin).map(k => new Promise(res => {\n      const script = resolve(dest, pkg.bin[k])\n      // Best effort.  Ignore errors here, the only result is that\n      // a bin script is not executable.  But if it's missing or\n      // something, we just leave it for a later stage to trip over\n      // when we can provide a more useful contextual error.\n      fs.stat(script, (er, st) => {\n        if (er)\n          return res()\n        const mode = st.mode | 0o111\n        if (mode === st.mode)\n          return res()\n        fs.chmod(script, mode, res)\n      })\n    })))\n  }\n\n  extract (dest) {\n    // if we've already loaded the manifest, then the super got it.\n    // but if not, read the unpacked manifest and chmod properly.\n    return super.extract(dest)\n      .then(result => this.package ? result\n        : readPackageJson(dest + '/package.json').then(pkg =>\n          this[_exeBins](pkg, dest)).then(() => result))\n  }\n\n  [_tarballFromResolved] () {\n    // create a read stream and return it\n    return new fsm.ReadStream(this.resolved)\n  }\n\n  packument () {\n    // simulate based on manifest\n    return this.manifest().then(mani => ({\n      name: mani.name,\n      'dist-tags': {\n        [this.defaultTag]: mani.version\n      },\n      versions: {\n        [mani.version]: {\n          ...mani,\n          dist: {\n            tarball: `file:${this.resolved}`,\n            integrity: this.integrity && String(this.integrity),\n          }\n        }\n      }\n    }))\n  }\n}\n\nmodule.exports = FileFetcher\n"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,cAAc,CAAC;AACvC,MAAMC,GAAG,GAAGD,OAAO,CAAC,aAAa,CAAC;AAClC,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAS,CAAC;AAClC,MAAM;EAAEG;AAAU,CAAC,GAAGH,OAAO,CAAC,MAAM,CAAC;AACrC,MAAMI,eAAe,GAAGJ,OAAO,CAAC,wBAAwB,CAAC;AACzD,MAAMK,oBAAoB,GAAGC,MAAM,CAACC,GAAG,CAAC,qCAAqC,CAAC;AAC9E,MAAMC,QAAQ,GAAGF,MAAM,CAAC,UAAU,CAAC;AACnC,MAAM;EAAEG;AAAQ,CAAC,GAAGT,OAAO,CAAC,MAAM,CAAC;AACnC,MAAMU,EAAE,GAAGV,OAAO,CAAC,IAAI,CAAC;AAExB,MAAMW,WAAW,SAASZ,OAAO,CAAC;EAChCa,WAAWA,CAAEC,IAAI,EAAEC,IAAI,EAAE;IACvB,KAAK,CAACD,IAAI,EAAEC,IAAI,CAAC;IACjB;IACA,IAAI,CAACC,QAAQ,GAAG,IAAI,CAACF,IAAI,CAACG,SAAS;EACrC;EAEA,IAAIC,KAAKA,CAAA,EAAI;IACX,OAAO,CAAC,MAAM,CAAC;EACjB;EAEAC,QAAQA,CAAA,EAAI;IACV,IAAI,IAAI,CAACC,OAAO,EACd,OAAOC,OAAO,CAACX,OAAO,CAAC,IAAI,CAACU,OAAO,CAAC;;IAEtC;IACA,OAAOjB,OAAO,CAACmB,GAAG,CAACC,OAAO,CAAC,IAAI,CAACC,KAAK,EAAE,IAAI,CAACT,IAAI,EAAEU,GAAG,IACnD,IAAI,CAACC,OAAO,CAACD,GAAG,CAAC,CAChBE,IAAI,CAAC,MAAMtB,eAAe,CAACoB,GAAG,GAAG,eAAe,CAAC,CAAC,CAClDE,IAAI,CAACC,IAAI,IAAI,IAAI,CAACR,OAAO,GAAG;MAC3B,GAAGQ,IAAI;MACPC,UAAU,EAAE,IAAI,CAACC,SAAS,IAAIC,MAAM,CAAC,IAAI,CAACD,SAAS,CAAC;MACpDE,SAAS,EAAE,IAAI,CAAChB,QAAQ;MACxBiB,KAAK,EAAE,IAAI,CAACC;IACd,CAAC,CAAC,CAAC;EACP;EAEA,CAACzB,QAAQ,EAAG0B,GAAG,EAAEC,IAAI,EAAE;IACrB,IAAI,CAACD,GAAG,CAACE,GAAG,EACV,OAAOhB,OAAO,CAACX,OAAO,CAAC,CAAC;IAE1B,OAAOW,OAAO,CAACiB,GAAG,CAACC,MAAM,CAACC,IAAI,CAACL,GAAG,CAACE,GAAG,CAAC,CAACI,GAAG,CAACC,CAAC,IAAI,IAAIrB,OAAO,CAACsB,GAAG,IAAI;MAClE,MAAMC,MAAM,GAAGlC,OAAO,CAAC0B,IAAI,EAAED,GAAG,CAACE,GAAG,CAACK,CAAC,CAAC,CAAC;MACxC;MACA;MACA;MACA;MACA/B,EAAE,CAACkC,IAAI,CAACD,MAAM,EAAE,CAACE,EAAE,EAAEC,EAAE,KAAK;QAC1B,IAAID,EAAE,EACJ,OAAOH,GAAG,CAAC,CAAC;QACd,MAAMK,IAAI,GAAGD,EAAE,CAACC,IAAI,GAAG,KAAK;QAC5B,IAAIA,IAAI,KAAKD,EAAE,CAACC,IAAI,EAClB,OAAOL,GAAG,CAAC,CAAC;QACdhC,EAAE,CAACsC,KAAK,CAACL,MAAM,EAAEI,IAAI,EAAEL,GAAG,CAAC;MAC7B,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC,CAAC;EACN;EAEAjB,OAAOA,CAAEU,IAAI,EAAE;IACb;IACA;IACA,OAAO,KAAK,CAACV,OAAO,CAACU,IAAI,CAAC,CACvBT,IAAI,CAACuB,MAAM,IAAI,IAAI,CAAC9B,OAAO,GAAG8B,MAAM,GACjC7C,eAAe,CAAC+B,IAAI,GAAG,eAAe,CAAC,CAACT,IAAI,CAACQ,GAAG,IAChD,IAAI,CAAC1B,QAAQ,CAAC,CAAC0B,GAAG,EAAEC,IAAI,CAAC,CAAC,CAACT,IAAI,CAAC,MAAMuB,MAAM,CAAC,CAAC;EACtD;EAEA,CAAC5C,oBAAoB,IAAK;IACxB;IACA,OAAO,IAAIJ,GAAG,CAACiD,UAAU,CAAC,IAAI,CAACnC,QAAQ,CAAC;EAC1C;EAEAoC,SAASA,CAAA,EAAI;IACX;IACA,OAAO,IAAI,CAACjC,QAAQ,CAAC,CAAC,CAACQ,IAAI,CAACC,IAAI,KAAK;MACnCyB,IAAI,EAAEzB,IAAI,CAACyB,IAAI;MACf,WAAW,EAAE;QACX,CAAC,IAAI,CAACC,UAAU,GAAG1B,IAAI,CAAC2B;MAC1B,CAAC;MACDC,QAAQ,EAAE;QACR,CAAC5B,IAAI,CAAC2B,OAAO,GAAG;UACd,GAAG3B,IAAI;UACP6B,IAAI,EAAE;YACJC,OAAO,EAAE,QAAQ,IAAI,CAAC1C,QAAQ,EAAE;YAChCc,SAAS,EAAE,IAAI,CAACA,SAAS,IAAIC,MAAM,CAAC,IAAI,CAACD,SAAS;UACpD;QACF;MACF;IACF,CAAC,CAAC,CAAC;EACL;AACF;AAEA6B,MAAM,CAACC,OAAO,GAAGhD,WAAW","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}