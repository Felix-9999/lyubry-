{"ast":null,"code":"// npm explore <pkg>[@<version>]\n// open a subshell to the package folder.\n\nconst rpj = require('read-package-json-fast');\nconst runScript = require('@npmcli/run-script');\nconst {\n  join,\n  resolve,\n  relative\n} = require('path');\nconst completion = require('./utils/completion/installed-shallow.js');\nconst BaseCommand = require('./base-command.js');\nclass Explore extends BaseCommand {\n  static get description() {\n    return 'Browse an installed package';\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get name() {\n    return 'explore';\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get usage() {\n    return ['<pkg> [ -- <command>]'];\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params() {\n    return ['shell'];\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  async completion(opts) {\n    return completion(this.npm, opts);\n  }\n  exec(args, cb) {\n    this.explore(args).then(() => cb()).catch(cb);\n  }\n  async explore(args) {\n    if (args.length < 1 || !args[0]) throw this.usage;\n    const pkgname = args.shift();\n\n    // detect and prevent any .. shenanigans\n    const path = join(this.npm.dir, join('/', pkgname));\n    if (relative(path, this.npm.dir) === '') throw this.usage;\n\n    // run as if running a script named '_explore', which we set to either\n    // the set of arguments, or the shell config, and let @npmcli/run-script\n    // handle all the escaping and PATH setup stuff.\n\n    const pkg = await rpj(resolve(path, 'package.json')).catch(er => {\n      this.npm.log.error('explore', `It doesn't look like ${pkgname} is installed.`);\n      throw er;\n    });\n    const {\n      shell\n    } = this.npm.flatOptions;\n    pkg.scripts = {\n      ...(pkg.scripts || {}),\n      _explore: args.join(' ').trim() || shell\n    };\n    if (!args.length) this.npm.output(`\\nExploring ${path}\\nType 'exit' or ^D when finished\\n`);\n    this.npm.log.disableProgress();\n    try {\n      return await runScript({\n        ...this.npm.flatOptions,\n        pkg,\n        banner: false,\n        path,\n        stdioString: true,\n        event: '_explore',\n        stdio: 'inherit'\n      }).catch(er => {\n        process.exitCode = typeof er.code === 'number' && er.code !== 0 ? er.code : 1;\n        // if it's not an exit error, or non-interactive, throw it\n        const isProcExit = er.message === 'command failed' && (typeof er.code === 'number' || /^SIG/.test(er.signal || ''));\n        if (args.length || !isProcExit) throw er;\n      });\n    } finally {\n      this.npm.log.enableProgress();\n    }\n  }\n}\nmodule.exports = Explore;","map":{"version":3,"names":["rpj","require","runScript","join","resolve","relative","completion","BaseCommand","Explore","description","name","usage","params","opts","npm","exec","args","cb","explore","then","catch","length","pkgname","shift","path","dir","pkg","er","log","error","shell","flatOptions","scripts","_explore","trim","output","disableProgress","banner","stdioString","event","stdio","process","exitCode","code","isProcExit","message","test","signal","enableProgress","module","exports"],"sources":["C:/Users/Felo/node_modules/npm/lib/explore.js"],"sourcesContent":["// npm explore <pkg>[@<version>]\n// open a subshell to the package folder.\n\nconst rpj = require('read-package-json-fast')\nconst runScript = require('@npmcli/run-script')\nconst { join, resolve, relative } = require('path')\nconst completion = require('./utils/completion/installed-shallow.js')\nconst BaseCommand = require('./base-command.js')\n\nclass Explore extends BaseCommand {\n  static get description () {\n    return 'Browse an installed package'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get name () {\n    return 'explore'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get usage () {\n    return ['<pkg> [ -- <command>]']\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params () {\n    return ['shell']\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  async completion (opts) {\n    return completion(this.npm, opts)\n  }\n\n  exec (args, cb) {\n    this.explore(args).then(() => cb()).catch(cb)\n  }\n\n  async explore (args) {\n    if (args.length < 1 || !args[0])\n      throw this.usage\n\n    const pkgname = args.shift()\n\n    // detect and prevent any .. shenanigans\n    const path = join(this.npm.dir, join('/', pkgname))\n    if (relative(path, this.npm.dir) === '')\n      throw this.usage\n\n    // run as if running a script named '_explore', which we set to either\n    // the set of arguments, or the shell config, and let @npmcli/run-script\n    // handle all the escaping and PATH setup stuff.\n\n    const pkg = await rpj(resolve(path, 'package.json')).catch(er => {\n      this.npm.log.error('explore', `It doesn't look like ${pkgname} is installed.`)\n      throw er\n    })\n\n    const { shell } = this.npm.flatOptions\n    pkg.scripts = {\n      ...(pkg.scripts || {}),\n      _explore: args.join(' ').trim() || shell,\n    }\n\n    if (!args.length)\n      this.npm.output(`\\nExploring ${path}\\nType 'exit' or ^D when finished\\n`)\n    this.npm.log.disableProgress()\n    try {\n      return await runScript({\n        ...this.npm.flatOptions,\n        pkg,\n        banner: false,\n        path,\n        stdioString: true,\n        event: '_explore',\n        stdio: 'inherit',\n      }).catch(er => {\n        process.exitCode = typeof er.code === 'number' && er.code !== 0 ? er.code\n          : 1\n        // if it's not an exit error, or non-interactive, throw it\n        const isProcExit = er.message === 'command failed' &&\n          (typeof er.code === 'number' || /^SIG/.test(er.signal || ''))\n        if (args.length || !isProcExit)\n          throw er\n      })\n    } finally {\n      this.npm.log.enableProgress()\n    }\n  }\n}\nmodule.exports = Explore\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}