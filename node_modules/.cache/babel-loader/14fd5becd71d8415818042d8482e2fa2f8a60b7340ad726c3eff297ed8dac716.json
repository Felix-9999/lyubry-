{"ast":null,"code":"const hookApi = require('libnpmhook');\nconst otplease = require('./utils/otplease.js');\nconst relativeDate = require('tiny-relative-date');\nconst Table = require('cli-table3');\nconst BaseCommand = require('./base-command.js');\nclass Hook extends BaseCommand {\n  static get description() {\n    return 'Manage registry hooks';\n  }\n  static get name() {\n    return 'hook';\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params() {\n    return ['registry', 'otp'];\n  }\n  static get usage() {\n    return ['add <pkg> <url> <secret> [--type=<type>]', 'ls [pkg]', 'rm <id>', 'update <id> <url> <secret>'];\n  }\n  exec(args, cb) {\n    this.hook(args).then(() => cb()).catch(cb);\n  }\n  async hook(args) {\n    return otplease(this.npm.flatOptions, opts => {\n      switch (args[0]) {\n        case 'add':\n          return this.add(args[1], args[2], args[3], opts);\n        case 'ls':\n          return this.ls(args[1], opts);\n        case 'rm':\n          return this.rm(args[1], opts);\n        case 'update':\n        case 'up':\n          return this.update(args[1], args[2], args[3], opts);\n        default:\n          throw this.usage;\n      }\n    });\n  }\n  async add(pkg, uri, secret, opts) {\n    const hook = await hookApi.add(pkg, uri, secret, opts);\n    if (opts.json) this.npm.output(JSON.stringify(hook, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'));\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${opts.unicode ? ' ➜ ' : ' -> '} ${hook.endpoint}`);\n    }\n  }\n  async ls(pkg, opts) {\n    const hooks = await hookApi.ls({\n      ...opts,\n      package: pkg\n    });\n    if (opts.json) this.npm.output(JSON.stringify(hooks, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hooks[0]).join('\\t'));\n      hooks.forEach(hook => {\n        this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n      });\n    } else if (!hooks.length) this.npm.output(\"You don't have any hooks configured yet.\");else if (!opts.silent && opts.loglevel !== 'silent') {\n      if (hooks.length === 1) this.npm.output('You have one hook configured.');else this.npm.output(`You have ${hooks.length} hooks configured.`);\n      const table = new Table({\n        head: ['id', 'target', 'endpoint']\n      });\n      hooks.forEach(hook => {\n        table.push([{\n          rowSpan: 2,\n          content: hook.id\n        }, this.hookName(hook), hook.endpoint]);\n        if (hook.last_delivery) {\n          table.push([{\n            colSpan: 1,\n            content: `triggered ${relativeDate(hook.last_delivery)}`\n          }, hook.response_code]);\n        } else table.push([{\n          colSpan: 2,\n          content: 'never triggered'\n        }]);\n      });\n      this.npm.output(table.toString());\n    }\n  }\n  async rm(id, opts) {\n    const hook = await hookApi.rm(id, opts);\n    if (opts.json) this.npm.output(JSON.stringify(hook, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'));\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`- ${this.hookName(hook)} ${opts.unicode ? ' ✘ ' : ' X '} ${hook.endpoint}`);\n    }\n  }\n  async update(id, uri, secret, opts) {\n    const hook = await hookApi.update(id, uri, secret, opts);\n    if (opts.json) this.npm.output(JSON.stringify(hook, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'));\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${opts.unicode ? ' ➜ ' : ' -> '} ${hook.endpoint}`);\n    }\n  }\n  hookName(hook) {\n    let target = hook.name;\n    if (hook.type === 'scope') target = '@' + target;\n    if (hook.type === 'owner') target = '~' + target;\n    return target;\n  }\n}\nmodule.exports = Hook;","map":{"version":3,"names":["hookApi","require","otplease","relativeDate","Table","BaseCommand","Hook","description","name","params","usage","exec","args","cb","hook","then","catch","npm","flatOptions","opts","add","ls","rm","update","pkg","uri","secret","json","output","JSON","stringify","parseable","Object","keys","join","map","k","silent","loglevel","hookName","unicode","endpoint","hooks","package","forEach","length","table","head","push","rowSpan","content","id","last_delivery","colSpan","response_code","toString","target","type","module","exports"],"sources":["C:/Users/Felo/node_modules/npm/lib/hook.js"],"sourcesContent":["const hookApi = require('libnpmhook')\nconst otplease = require('./utils/otplease.js')\nconst relativeDate = require('tiny-relative-date')\nconst Table = require('cli-table3')\n\nconst BaseCommand = require('./base-command.js')\nclass Hook extends BaseCommand {\n  static get description () {\n    return 'Manage registry hooks'\n  }\n\n  static get name () {\n    return 'hook'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params () {\n    return [\n      'registry',\n      'otp',\n    ]\n  }\n\n  static get usage () {\n    return [\n      'add <pkg> <url> <secret> [--type=<type>]',\n      'ls [pkg]',\n      'rm <id>',\n      'update <id> <url> <secret>',\n    ]\n  }\n\n  exec (args, cb) {\n    this.hook(args).then(() => cb()).catch(cb)\n  }\n\n  async hook (args) {\n    return otplease(this.npm.flatOptions, (opts) => {\n      switch (args[0]) {\n        case 'add':\n          return this.add(args[1], args[2], args[3], opts)\n        case 'ls':\n          return this.ls(args[1], opts)\n        case 'rm':\n          return this.rm(args[1], opts)\n        case 'update':\n        case 'up':\n          return this.update(args[1], args[2], args[3], opts)\n        default:\n          throw this.usage\n      }\n    })\n  }\n\n  async add (pkg, uri, secret, opts) {\n    const hook = await hookApi.add(pkg, uri, secret, opts)\n    if (opts.json)\n      this.npm.output(JSON.stringify(hook, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'))\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${\n        opts.unicode ? ' ➜ ' : ' -> '\n      } ${hook.endpoint}`)\n    }\n  }\n\n  async ls (pkg, opts) {\n    const hooks = await hookApi.ls({ ...opts, package: pkg })\n    if (opts.json)\n      this.npm.output(JSON.stringify(hooks, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hooks[0]).join('\\t'))\n      hooks.forEach(hook => {\n        this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n      })\n    } else if (!hooks.length)\n      this.npm.output(\"You don't have any hooks configured yet.\")\n    else if (!opts.silent && opts.loglevel !== 'silent') {\n      if (hooks.length === 1)\n        this.npm.output('You have one hook configured.')\n      else\n        this.npm.output(`You have ${hooks.length} hooks configured.`)\n\n      const table = new Table({ head: ['id', 'target', 'endpoint'] })\n      hooks.forEach((hook) => {\n        table.push([\n          { rowSpan: 2, content: hook.id },\n          this.hookName(hook),\n          hook.endpoint,\n        ])\n        if (hook.last_delivery) {\n          table.push([\n            {\n              colSpan: 1,\n              content: `triggered ${relativeDate(hook.last_delivery)}`,\n            },\n            hook.response_code,\n          ])\n        } else\n          table.push([{ colSpan: 2, content: 'never triggered' }])\n      })\n      this.npm.output(table.toString())\n    }\n  }\n\n  async rm (id, opts) {\n    const hook = await hookApi.rm(id, opts)\n    if (opts.json)\n      this.npm.output(JSON.stringify(hook, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'))\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`- ${this.hookName(hook)} ${\n        opts.unicode ? ' ✘ ' : ' X '\n      } ${hook.endpoint}`)\n    }\n  }\n\n  async update (id, uri, secret, opts) {\n    const hook = await hookApi.update(id, uri, secret, opts)\n    if (opts.json)\n      this.npm.output(JSON.stringify(hook, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'))\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${\n        opts.unicode ? ' ➜ ' : ' -> '\n      } ${hook.endpoint}`)\n    }\n  }\n\n  hookName (hook) {\n    let target = hook.name\n    if (hook.type === 'scope')\n      target = '@' + target\n    if (hook.type === 'owner')\n      target = '~' + target\n    return target\n  }\n}\nmodule.exports = Hook\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}